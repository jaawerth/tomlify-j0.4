;(function(){'use strict';function v(a,c,b){if(null==a)throw Error("Undefined or null cannot be stringified.");if(H(a))throw Error("Converting circular structure to TOML.");c="function"===typeof c?c:null;b=C(b);if(!r(a))return D(a,c,b);var e=[];x({path:[],table:{"":a},c:!1,replace:c,a:0,b:b,d:e},"",a,function(a,b,c){var f=null;if(r(c))""!==b&&(0<e.length&&e.push(""),f=a.c?"[["+y(a.path,!0)+"]]":"["+y(a.path,!0)+"]",e.push(t(f,a.a,a.b)));else if(q(c))if(h(b))w(c)||(f=A(a,b,c),h(f)&&e.push(t(f,a.a,a.b)));
else return!0;else return h(b)&&(f=A(a,b,c),h(f)&&e.push(t(f,a.a,a.b))),!0});return e.join("\n")}function C(a){return h(a)?a:"number"===typeof a&&0<=a&&isFinite(a)&&Math.floor(a)===a?E(" ",a):""}function t(a,c,b){c=E(b,c);return a.replace(/^/mg,c)}function E(a,c){if(a.repeat)return a.repeat(c);for(var b="",e="";0<c;)e+=e||a,c&1&&(b+=e),c>>>=1;return b}function x(a,c,b,e){if(!e(a,c,b)){c=a.table;a.table=b;if(q(b)){var f=a.c;a.c=w(b);for(var d=0,l=b.length;d<l;d++)a.path.push(d),x(a,d,b[d],e),a.path.pop();
a.c=f}else if(r(b)){f=a.c;a.c=!1;var p=[],m=[],g;for(g in b)Object.prototype.hasOwnProperty.call(b,g)&&(d=b[g],l=0<a.path.length&&(q(d)?w(d):r(d)),q(d)&&w(d)?m.push(g,d,l):r(d)?p.push(g,d,l):(a.path.push(g),x(a,g,d,e),a.path.pop()));if(a.replace){d=0;for(l=p.length;d<l;d+=3)a.path.push(p[d]),b=B(a,p[d],p[d+1]),h(b)?(a.d.push(t(b,a.a,a.b)),p[d+1]=null):null==b&&(p[d+1]=null),a.path.pop();d=0;for(l=m.length;d<l;d+=3){a.path.push(m[d]);b=B(a,m[d],m[d+1]);if(h(b))b=u(m[d])+" = "+b,a.d.push(t(b,a.a,a.b));
else if(null==b){m[d+1]=null;a.path.pop();continue}var n=0;for(g=m[d+1].length;n<g;n++)if(a.path.push(n),b=B(a,d,m[d+1][n]),a.path.pop(),!1!==b){b=A(a,m[d],m[d+1]);h(b)&&a.d.push(t(b,a.a,a.b));m[d+1]=null;break}a.path.pop()}}g=p.concat(m);d=0;for(l=g.length;d<l;d+=3)null!=g[d+1]&&(a.path.push(g[d]),g[d+2]&&a.a++,x(a,g[d],g[d+1],e),g[d+2]&&a.a--,a.path.pop());a.c=f}a.table=c}}function B(a,c,b){b=a.replace.call(F(a),c,b);if(h(b))return u(c)+" = "+b;if(null==b)return null;if(!1!==b)throw Error(n(a.path,
"Replacer must return a string, false, null or undefined."));return!1}function F(a){var c={},b;for(b in a.table)c[b]=a.table[b];return{path:a.path.slice(0),table:c}}function A(a,c,b){var e=u(c);if(!e)throw Error(n(a.path,"Key cannot be an empty string."));a=z(a,c,b);return h(a)?e+" = "+a:null}function u(a){return a?/^[a-zA-Z0-9\-_]+$/.test(a)?a:G(a):!1}function D(a,c,b){if(null==a)throw Error("Undefined or null cannot be stringified.");return z({path:[],table:{"":a},c:!1,replace:"function"===typeof c?
c:null,a:0,b:C(b)},"",a)}function z(a,c,b){if(a.replace){c=a.replace.call(F(a),c,b);if(h(c))return c;if(null==c)return null;if(!1!==c)throw Error(n(a.path,"Replacer must return a string, false, null or undefined."));}switch(f(b)){case f.Boolean:return b?"true":"false";case f.String:return G(b);case f.Number:if(!isFinite(b))throw Error(n(a.path,"Number must be finite."));a=(Number.e?Number.e(b):Math.floor(b)===b)?b.toFixed(1):String(b);a=a.replace(/([eE])(\d)/,"$1+$2");return/[.eE]/.test(a)?a:a+".0";
case f.Array:var e;a:{if(!(2>b.length)){e=f(b[0]);c=1;for(var k=b.length;c<k;c++)if(null!=b[c]&&f(b[c])!==e){e=!0;break a}}e=!1}if(e)throw Error(n(a.path,"Array cannot contain values of different types."));c=a.table;a.table=b;e=[];for(var k=0,d=b.length;k<d;k++)if(null!=b[k]){a.path.push(k);var l=z(a,k,b[k]);h(l)&&e.push(l);a.path.pop()}a.table=c;if(c=0<e.length&&a.b){a:{if(!(1>b.length))for(c=0,k=b.length;c<k;c++)if(q(b[c])){c=!0;break a}c=!1}c=c||w(b)}return c?"[\n"+t(e.join(",\n"),1,a.b)+"\n]":
"["+e.join(", ")+"]";case f.Date:if(!isFinite(b.getTime()))throw Error(n(a.path,"Invalid Date"));return b.toISOString();default:c=a.table;a.table=b;k=[];for(e in b)if(Object.prototype.hasOwnProperty.call(b,e)&&null!=b[e]){if(!e)throw Error(n(a.path,"Key cannot be an empty string."));a.path.push(e);d=z(a,e,b[e]);h(d)&&k.push(u(e)+" = "+d);a.path.pop()}a.table=c;return"{"+k.join(", ")+"}"}}function G(a){return"object"===typeof JSON&&JSON?JSON.stringify(a):'"'+String(a).replace(/[\x00-\x1F"\\]/g,function(a){switch(a){case '"':case "\\":return"\\"+
a;case "\t":return"\\t";case "\n":return"\\n";case "\r":return"\\r";case "\b":return"\\b";case "\f":return"\\f";default:return a=a.charCodeAt(0).toString(16),"\\u"+"0000".substr(a.length)+a}})+'"'}function H(a){function c(a,e){if(!q(a)&&!r(a))return!1;if(-1!==e.indexOf(a))return!0;e.push(a);for(var f in a)if(Object.prototype.hasOwnProperty.call(a,f)){var d=e.length;if(c(a[f],e))return!0;e.splice(d)}return!1}return c(a,[])}function w(a){if(1>a.length)return!1;for(var c=0,b=a.length;c<b;c++)if(r(a[c]))return!0;
return!1}function r(a){return null!==a&&"object"===typeof a&&!(q(a)||f(a)===f.Date)}function h(a){return"string"===typeof a}function f(a){return Object.prototype.toString.call(a)}function n(a,c){return(y(a)||"<root>")+": "+c}function y(a,c){if(0===a.length)return"";for(var b="",e=0,f=a.length;e<f;e++)if(h(a[e])&&a[e])b+=(b?".":"")+u(a[e]);else if("number"===typeof a[e])c||(b+=(b?".":"")+"["+a[e]+"]");else return!1;return b?b:!1}f.Boolean=f(!1);f.String=f("");f.Number=f(0);f.Array=f([]);f.Date=f(new Date(0));
var q=Array.isArray||function(a){return f(a)===f.Array};v.toKey=function(a,c){if(h(a)){var b=u(a);if(!b)throw Error("Key cannot be an empty string.");return b}if(q(a)){b=y(a,c);if(!1===b)throw Error("Key path must consist of non-empty string(s).");return b}throw Error("Invalid Arguments for tomlify.toKey({String | Array})");};v.toValue=D;null!=("undefined"!==typeof module&&null!==module?module.exports:void 0)?module.exports=v:"function"===typeof define&&define.amd?define([],function(){return v}):
this.tomlify=v}).call(this);
